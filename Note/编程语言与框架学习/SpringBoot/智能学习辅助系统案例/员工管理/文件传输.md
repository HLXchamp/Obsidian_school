![[Pasted image 20240508230023.png]]

![[Pasted image 20240508230038.png]]

![[Pasted image 20240508230203.png]]

### 本地存储

![[Pasted image 20240509001456.png]]

![[Pasted image 20240509001527.png]]

创建一个UploadController类专门用于文件传输：

```Java
@PostMapping("/upload")  
public Result upload(String username, Integer age, MultipartFile image) throws IOException {  
    log.info("文件上传：{}，{}，{}", username, age, image);  
    //获取原始文件名  
    String originalFilename = image.getOriginalFilename();  
    //创建唯一的文件名——用UUID（通用统一识别码）  
    int index = originalFilename.lastIndexOf(".");  
    String extname = originalFilename.substring(index);  
    String newFileName = UUID.randomUUID().toString() + extname;  
    log.info("新文件名：{}", newFileName);  
  
    //存在本地  
    image.transferTo(new File("D:\\BaiduNetdiskDownload\\"+newFileName));  
  
    return Result.success();  
}
```

```
#配置单个文件上传的最大大小限制  
spring.servlet.multipart.max-file-size=10MB  
#配置单个请求最大大小的限制（一次请求可以传多个文件）  
spring.servlet.multipart.max-request-size=100MB
```
![[Pasted image 20240509002440.png]]

### 阿里云OSS

![[Pasted image 20240509085743.png]]

![[Pasted image 20240509085811.png]]

![[Pasted image 20240509085918.png]]

阿里云_配置OSS环境变量见[03_阿里云_配置OSS环境变量](https://blog.csdn.net/qq_59621600/article/details/134859770)。

![[Pasted image 20240509094934.png]]

![[Pasted image 20240509101149.png]]

新建一个AliOSSUtils类：
```java
package org.example.utils;  
  
import com.aliyun.oss.OSS;  
import com.aliyun.oss.OSSClientBuilder;  
import org.springframework.stereotype.Component;  
import org.springframework.web.multipart.MultipartFile;  
import java.io.*;  
import java.util.UUID;  
  
/**  
 * 阿里云 OSS 工具类  
 */  
@Component  
public class AliOSSUtils {  
  
    private String endpoint = "https://oss-cn-hangzhou.aliyuncs.com";  
    private String accessKeyId = ...;  
    private String accessKeySecret = ...;  
    private String bucketName = "web-tlias-hlx";  
  
    /**  
     * 实现上传图片到OSS  
     */    public String upload(MultipartFile file) throws IOException {  
        // 获取上传的文件的输入流  
        InputStream inputStream = file.getInputStream();  
  
        // 避免文件覆盖  
        String originalFilename = file.getOriginalFilename();  
        String fileName = UUID.randomUUID().toString() + originalFilename.substring(originalFilename.lastIndexOf("."));  
  
        //上传文件到 OSS        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);  
        ossClient.putObject(bucketName, fileName, inputStream);  
  
        //文件访问路径  
        String url = endpoint.split("//")[0] + "//" + bucketName + "." + endpoint.split("//")[1] + "/" + fileName;  
        // 关闭ossClient  
        ossClient.shutdown();  
        return url;// 把上传到oss的路径返回  
    }  
  
}
```

UploadController：

```java
//阿里云OSS存储  
@PostMapping("/upload")  
public Result upload(MultipartFile image) throws IOException {  
    log.info("文件上传：文件名{}", image.getOriginalFilename());  
    //调用阿里云oss工具进行文件上传  
    String url = aliOSSUtils.upload(image);  
    log.info("文件上传完成，文件访问的url：{}",url);  
  
    return Result.success(url);  
}
```

执行成功：

![[Pasted image 20240509101456.png]]

![[VTT@`RD_U(_4T6I)%{%}6GY.png|325]]

![[Pasted image 20240509101808.png]]


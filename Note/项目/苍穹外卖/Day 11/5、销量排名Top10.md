### 需求分析与设计

![[Pasted image 20240601163353.png|625]]

![[Pasted image 20240601163417.png]]
### 代码开发

![[Pasted image 20240601163538.png]]

ReportController：

```java
@GetMapping("/top10")  
@ApiOperation("销量排名Top10统计")  
public Result<SalesTop10ReportVO> top10(  
        @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate begin,  
        @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate end){  
    log.info("Top10数据统计：begin:{},end:{}", begin, end);  
    return Result.success(reportService.getSalesTop10(begin,end));  
}
```

ReportService：

```java
/**  
 * 统计指定时间内的销量排名前10  
 * @param begin  
 * @param end  
 * @return  
 */  
SalesTop10ReportVO getSalesTop10(LocalDate begin, LocalDate end);
```

```java
@Override  
public SalesTop10ReportVO getSalesTop10(LocalDate begin, LocalDate end) {  
  
    LocalDateTime beginTime = LocalDateTime.of(begin, LocalTime.MIN);  
    LocalDateTime endTime = LocalDateTime.of(end, LocalTime.MAX);  
  
    List<GoodsSalesDTO> salesTop10 = orderMapper.getSalesTop10(beginTime, endTime);  
  
    List<String> names = salesTop10.stream().map(GoodsSalesDTO::getName).collect(Collectors.toList());  
    String nameList = StringUtils.join(names, ",");  
  
    List<Integer> numbers = salesTop10.stream().map(GoodsSalesDTO::getNumber).collect(Collectors.toList());  
    String numberList = StringUtils.join(numbers, ",");  
  
    return SalesTop10ReportVO  
            .builder()  
            .nameList(nameList)  
            .numberList(numberList)  
            .build();  
}
```

OrderMapper：

```java
/**  
 * 统计指定区间内的销量前10  
 * @param begin  
 * @param end  
 * @return  
 */  
List<GoodsSalesDTO> getSalesTop10(LocalDateTime begin, LocalDateTime end);
```

```xml
<select id="getSalesTop10" resultType="com.sky.dto.GoodsSalesDTO">  
    select od.name, sum(od.number) number from order_detail od,orders o where od.order_id = o.id and o.status = 5  
    <if test="begin != null"> and o.order_time &gt; #{begin} </if>  
    <if test="end != null"> and o.order_time &lt; #{end} </if>  
    group by od.name  
    order by number desc    
    limit 0,10
</select>
```

### 测试

![[Pasted image 20240601165537.png|600]]
### 需求分析与设计

##### 业务规则：

- 再来一单就是将原订单中的商品重新加入到购物车中

![[Pasted image 20240529110607.png|375]]

### 易错点

是将原订单中的商品重新加入到购物车中，所以可以看成是购物车相关操作。

在 MyBatis 中，`parameterType` 用于指定传递给映射方法的参数类型。在大多数情况下，当使用集合（如 `List`）或数组时，明确指定 `parameterType` 是一种良好的实践。

### 代码开发

OrderController：

```java
@PostMapping("/repetition/{id}")  
@ApiOperation("再来一单")  
public Result repeatOrder(@PathVariable Long id) {  
    log.info("要再来一单的订单id：{}", id);  
    orderService.repeatOrder(id);  
    return Result.success();  
}
```

OrderService：

```java
/**  
 * 再来一单  
 * @param id  
 */  
void repeatOrder(Long id);
```

```java
@Override  
public void repeatOrder(Long id) {  
    //将原订单的商品重新加入到购物车中  
    List<OrderDetail> orderDetailList = orderDetailMapper.getByOrderId(id);  
    if (orderDetailList == null) {  
        throw new OrderBusinessException(MessageConstant.ORDER_NOT_FOUND);  
    }  
    Long userId = BaseContext.getCurrentId();  
    List<ShoppingCart> shoppingCartList = new ArrayList<>();  
  
    for (OrderDetail orderDetail : orderDetailList) {  
        ShoppingCart shoppingCart = new ShoppingCart();  
        BeanUtils.copyProperties(orderDetail, shoppingCart);  
        shoppingCart.setUserId(userId);  
        shoppingCartList.add(shoppingCart);  
    }  
  
    shoppingCartMapper.insertBatch(shoppingCartList);  
}
```

ShoppingCartMapper：

```java
/**  
 * 批量添加购物车数据  
 * @param shoppingCartList  
 */  
void insertBatch(List<ShoppingCart> shoppingCartList);
```

```java
<insert id="insertBatch" parameterType="list">  
    insert into shopping_cart (name, image, user_id, dish_id, setmeal_id, dish_flavor, number, amount, create_time) VALUES  
    <foreach collection="shoppingCartList" item="sc" separator=",">  
        (#{sc.name},#{sc.image},#{sc.userId},#{sc.dishId},#{sc.setmealId},#{sc.dishFlavor},#{sc.number},#{sc.amount},#{sc.createTime})  
    </foreach>  
</insert>
```

### 测试

![[Pasted image 20240529130456.png|269]]